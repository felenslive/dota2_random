<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DOTA 2 PARTY RANDOMIZER</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&family=Roboto+Condensed:wght@400;700&display=swap');

        :root {
            --bg-dark: #0f0f0f;
            --panel-bg: #151515;
            --dota-red: #8b0000;
            --dota-red-bright: #ff2d2d;
            --text-gold: #c7b074;
            --text-grey: #888;
            --border-color: #333;
        }

        * {
            box-sizing: border-box;
            user-select: none;
        }

        body {
            margin: 0;
            padding: 0;
            font-family: 'Cinzel', serif;
            background-color: var(--bg-dark);
            background-image: linear-gradient(rgba(0, 0, 0, 0.85), rgba(0, 0, 0, 0.6)), url('wallpaper_preview.jpg');
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
            color: #ccc;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            overflow-x: hidden;
        }

        /* --- HEADER --- */
        header {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-top: 20px;
            width: 100%;
        }

        h1 {
            color: var(--text-gold);
            text-shadow: 0 0 15px rgba(199, 176, 116, 0.4);
            font-size: 2.5rem;
            text-transform: uppercase;
            letter-spacing: 4px;
            margin: 0;
        }

        .top-controls {
            display: flex;
            gap: 20px;
            margin-top: 20px;
        }

        /* --- BUTTONS --- */
        button {
            font-family: 'Cinzel', serif;
            cursor: pointer;
            text-transform: uppercase;
            transition: all 0.2s;
            border: 1px solid #444;
            outline: none;
            font-weight: bold;
        }

        .btn-main {
            background: linear-gradient(to bottom, #5e0b0b, #2b0000);
            color: #fff;
            font-size: 1.2rem;
            padding: 12px 40px;
            border: 1px solid #ff4444;
            box-shadow: 0 0 15px rgba(255, 0, 0, 0.3);
            letter-spacing: 2px;
        }

        .btn-main:hover {
            background: linear-gradient(to bottom, #7a1515, #420000);
            box-shadow: 0 0 25px rgba(255, 68, 68, 0.5);
            transform: scale(1.05);
        }

        .btn-secondary {
            background: #222;
            color: var(--text-gold);
            border: 1px solid var(--text-gold);
            padding: 10px 20px;
        }

        .btn-secondary:hover {
            background: #333;
            color: #fff;
        }

        .btn-reroll {
            background: linear-gradient(#3a3a3a, #222);
            color: #ccc;
            padding: 10px 0;
            width: 100%;
            border-top: 1px solid #555;
        }
        
        .btn-reroll:hover {
            color: #fff;
            background: #444;
        }

        /* --- APP CONTAINER --- */
        .app-container {
            display: flex;
            align-items: center; /* Center vertically to align + buttons */
            justify-content: center;
            width: 95%;
            margin-top: 30px;
            gap: 15px;
        }

        .players-wrapper {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 20px;
            max-width: 1600px;
        }

        /* --- ADD PLAYER BUTTONS --- */
        .btn-add-player {
            background: rgba(0,0,0,0.5);
            border: 2px dashed #444;
            color: #444;
            font-size: 3rem;
            width: 60px;
            height: 400px; /* Match approximate card height */
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 10px;
            transition: 0.3s;
        }

        .btn-add-player:hover {
            border-color: var(--text-gold);
            color: var(--text-gold);
            background: rgba(0,0,0,0.8);
        }

        /* --- PLAYER CARD --- */
        .player-card {
            background: var(--panel-bg);
            border: 1px solid var(--border-color);
            border-top: 3px solid var(--dota-red);
            width: 300px;
            display: flex;
            flex-direction: column;
            align-items: center;
            box-shadow: 0 10px 25px rgba(0,0,0,0.7);
            position: relative;
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .btn-remove {
            position: absolute;
            top: 5px;
            right: 5px;
            background: transparent;
            border: none;
            color: #444;
            font-size: 1.2rem;
            cursor: pointer;
        }
        .btn-remove:hover { color: red; }

        .player-name-input {
            background: transparent;
            border: none;
            border-bottom: 1px solid #444;
            color: #fff;
            font-family: 'Cinzel', serif;
            font-size: 1.5rem;
            text-align: center;
            margin: 15px 0 10px 0;
            width: 80%;
            outline: none;
        }
        
        .player-name-input:focus {
            border-bottom-color: var(--dota-red);
        }

        /* --- FILTERS --- */
        .filters-container {
            width: 100%;
            padding: 0 15px;
            margin-bottom: 10px;
        }
        
        .filter-group {
            margin-bottom: 8px;
            border-bottom: 1px solid #222;
            padding-bottom: 5px;
        }

        .filter-title {
            font-size: 0.7rem;
            color: #666;
            text-transform: uppercase;
            margin-bottom: 5px;
            display: block;
        }

        .filter-row {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
        }

        .filter-label {
            font-family: 'Roboto Condensed', sans-serif;
            font-size: 0.8rem;
            color: #999;
            cursor: pointer;
            display: flex;
            align-items: center;
        }
        
        .filter-label input { margin-right: 5px; accent-color: var(--dota-red); }
        .filter-label:hover { color: #fff; }

/* --- SLOT WINDOW (Обновлено) --- */
        .slot-window {
            width: 235px;
            height: 272px;
            background: #000;
            border: 2px solid #222;
            box-shadow: inset 0 0 15px #000;
            overflow: hidden;
            position: relative;
            margin-bottom: 0;
            /* Фон-заглушка, пока грузится картинка */
            background-color: #151515;
        }

        .reel {
            width: 100%;
            position: absolute;
            top: 0;
            left: 0;
        }

        /* --- HERO IMAGE (Главное исправление) --- */
        .hero-img {
            width: 100%;
            height: 272px;
            object-fit: cover;
            object-position: top center; /* Фокус на верхней части (лицах) */
            display: block;
            border-bottom: 1px solid #000;
            background: #151515; 
        }

        .hero-name-overlay {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            background: linear-gradient(transparent, rgba(0,0,0,0.95));
            color: #fff;
            text-align: center;
            padding: 15px 0 10px 0;
            font-size: 1.2rem;
            text-transform: uppercase;
            opacity: 0;
            transition: opacity 0.5s;
        }
        
        .slot-window.finished .hero-name-overlay { opacity: 1; }

        /* --- HERO BAN MODAL --- */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.9);
            z-index: 100;
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background: #1a1a1a;
            border: 1px solid var(--text-gold);
            width: 90%;
            max-width: 1000px;
            max-height: 90vh;
            padding: 20px;
            overflow-y: auto;
            position: relative;
        }

/* --- МОДАЛЬНОЕ ОКНО И ФИЛЬТРЫ (Новое) --- */
        .modal-header {
            display: flex;
            flex-direction: column; /* Элементы друг под другом */
            gap: 15px;
            margin-bottom: 20px;
            border-bottom: 1px solid #333;
            padding-bottom: 15px;
        }

        .filter-bar {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            align-items: center;
            justify-content: space-between;
            width: 100%;
            background: #111;
            padding: 10px;
            border: 1px solid #333;
        }

        .filter-group-row {
            display: flex;
            gap: 5px;
            align-items: center;
        }

        .filter-label-text {
            color: #666; 
            font-size: 0.8rem; 
            margin-right: 5px; 
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        /* Кнопки атрибутов (Круглые иконки) */
        .attr-btn {
            width: 32px; height: 32px;
            border: 2px solid #444;
            border-radius: 50%;
            cursor: pointer;
            display: flex; /* Центрирование картинки/иконки */
            align-items: center;
            justify-content: center;
            transition: 0.2s;
            background-size: cover;
            filter: grayscale(1); /* Серые, пока не активны */
            opacity: 0.7;
        }
        
        .attr-btn:hover { opacity: 1; filter: grayscale(0.5); }
        .attr-btn.active { filter: grayscale(0); border-color: #fff; opacity: 1; transform: scale(1.1); box-shadow: 0 0 10px rgba(255,255,255,0.2); }

        /* Цвета для атрибутов */
        .attr-str { background-color: #ec3d06; background-image: url('https://cdn.cloudflare.steamstatic.com/apps/dota2/images/dota_react/icons/hero_strength.png'); }
        .attr-agi { background-color: #26e030; background-image: url('https://cdn.cloudflare.steamstatic.com/apps/dota2/images/dota_react/icons/hero_agility.png'); }
        .attr-int { background-color: #00d9ec; background-image: url('https://cdn.cloudflare.steamstatic.com/apps/dota2/images/dota_react/icons/hero_intelligence.png'); }
        .attr-all { background-color: #be00ec; background-image: url('https://cdn.cloudflare.steamstatic.com/apps/dota2/images/dota_react/icons/hero_universal.png'); }

        /* Кнопки сложности (Ромбики) */
        .complex-btn {
            width: 25px; height: 25px;
            border: 1px solid #444;
            transform: rotate(45deg); /* Ромб */
            margin: 5px;
            cursor: pointer;
            background: #222;
            transition: 0.2s;
        }
        .complex-btn:hover { border-color: #888; }
        .complex-btn.active { background: #fff; box-shadow: 0 0 8px #fff; border-color: #fff; }

        /* Поле поиска */
        #hero-search-input {
            background: #000;
            border: 1px solid #444;
            color: #fff;
            padding: 8px 15px;
            font-family: 'Cinzel', serif;
            font-size: 1rem;
            width: 200px;
            outline: none;
        }

        /* --- СЕТКА ГЕРОЕВ (Исправлена под горизонтальные) --- */
        .hero-grid {
            display: grid;
            /* Адаптивная ширина: ~100px на героя */
            grid-template-columns: repeat(auto-fill, minmax(90px, 1fr));
            gap: 8px;
            padding-right: 5px;
        }

        .hero-grid-item {
            cursor: pointer;
            position: relative;
            transition: 0.2s;
            border: 2px solid transparent;
            overflow: hidden;
            background: #000;
            /* Горизонтальный формат (соотношение сторон как в Доте) */
            aspect-ratio: 16 / 9; 
        }

        .hero-grid-item img {
            width: 100%;
            height: 100%;
            object-fit: cover; /* Заполняет весь блок */
            display: block;
            filter: grayscale(0.2);
            transition: 0.2s;
        }

        .hero-grid-item:hover { transform: scale(1.1); z-index: 10; border-color: #fff; }
        .hero-grid-item:hover img { filter: grayscale(0); }

        .hero-grid-item.banned img { filter: grayscale(1) brightness(0.2); }
        .hero-grid-item.banned::after {
            content: "X"; /* Просто крестик, чтобы не закрывать картинку текстом */
            position: absolute;
            top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            color: red;
            font-size: 2rem;
            font-weight: bold;
            text-shadow: 0 0 5px #000;
        }

        .hero-grid-item {
            cursor: pointer;
            position: relative;
            transition: 0.2s;
            border: 2px solid transparent;
        }

        .hero-grid-item img {
            width: 100%;
            display: block;
            filter: grayscale(0.2);
        }

        .hero-grid-item:hover { transform: scale(1.1); z-index: 10; border-color: #fff; }

        .hero-grid-item.banned img {
            filter: grayscale(1) brightness(0.3);
        }

        .hero-grid-item.banned::after {
            content: "X";
            position: absolute;
            top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            color: red;
            font-size: 3rem;
            font-weight: bold;
        }

        /* --- CHALLENGE SECTION --- */
        .challenge-section {
            width: 100%;
            max-width: 800px;
            background: rgba(0, 0, 0, 0.5);
            border-top: 1px solid var(--border-color);
            padding: 30px;
            margin-top: 50px;
            margin-bottom: 50px;
            text-align: center;
        }

        .challenge-text {
            font-size: 1.3rem;
            color: #eee;
            min-height: 1.5em;
            font-style: italic;
            margin-top: 15px;
        }

    </style>
</head>
<body>

    <header>
        <h1>Dota 2 Party Randomizer</h1>
        <div class="top-controls">
            <button class="btn-secondary" onclick="toggleBanList()">Список Героев (Баны)</button>
            <button class="btn-main" onclick="rollAll()">ROLL PARTY</button>
        </div>
    </header>

    <div class="app-container">
        <button class="btn-add-player" onclick="addPlayer('start')" title="Добавить игрока слева">+</button>

        <div class="players-wrapper" id="players-container">
            </div>

        <button class="btn-add-player" onclick="addPlayer('end')" title="Добавить игрока справа">+</button>
    </div>

    <div class="challenge-section">
        <button class="btn-secondary" onclick="generateChallenge()">Челлендж от Габена</button>
        <div class="challenge-text" id="challenge-output">
            Ждем задания...
        </div>
    </div>

<div class="modal-overlay" id="ban-modal">
        <div class="modal-content">
            <div class="modal-header">
                <div style="display:flex; justify-content:space-between; width:100%;">
                    <h2 style="margin:0; color:white;">Управление Пулом</h2>
                    <button class="btn-secondary" onclick="toggleBanList()">Закрыть</button>
                </div>
                
                <div class="filter-bar">
                    <div class="filter-group-row">
                        <span class="filter-label-text">Атрибут</span>
                        <div class="attr-btn attr-str" onclick="toggleFilter('attr', 'str', this)" title="Сила"></div>
                        <div class="attr-btn attr-agi" onclick="toggleFilter('attr', 'agi', this)" title="Ловкость"></div>
                        <div class="attr-btn attr-int" onclick="toggleFilter('attr', 'int', this)" title="Интеллект"></div>
                        <div class="attr-btn attr-all" onclick="toggleFilter('attr', 'all', this)" title="Универсал"></div>
                    </div>

                    <div class="filter-group-row">
                        <span class="filter-label-text">Сложность</span>
                        <div class="complex-btn" onclick="toggleFilter('complex', 1, this)" title="Легко"></div>
                        <div class="complex-btn" onclick="toggleFilter('complex', 2, this)" title="Средне"></div>
                        <div class="complex-btn" onclick="toggleFilter('complex', 3, this)" title="Сложно"></div>
                    </div>

                    <div class="filter-group-row">
                        <input type="text" id="hero-search-input" placeholder="Поиск..." oninput="applyGridFilters()">
                    </div>
                </div>
            </div>
            
            <div class="hero-grid" id="hero-grid">
                </div>
        </div>
    </div>

<script>
    // --- ИСПРАВЛЕННАЯ БАЗА ГЕРОЕВ (127 героев + Kez + Largo) ---
    // Исправлены системные ID для картинок (Wraith King -> skeleton_king и т.д.)
    const heroesData = [
        { id: 'abaddon', name: 'Abaddon', roles: ['offlane', 'support'], range: 'melee', mainAttr: 'all', complexity: 1 },
        { id: 'alchemist', name: 'Alchemist', roles: ['carry', 'mid'], range: 'melee', mainAttr: 'str', complexity: 1 },
        { id: 'ancient_apparition', name: 'Ancient Apparition', roles: ['support'], range: 'ranged', mainAttr: 'int', complexity: 2 },
        { id: 'antimage', name: 'Anti-Mage', roles: ['carry'], range: 'melee', mainAttr: 'agi', complexity: 1 },
        { id: 'arc_warden', name: 'Arc Warden', roles: ['carry', 'mid'], range: 'ranged', mainAttr: 'agi', complexity: 3 },
        { id: 'axe', name: 'Axe', roles: ['offlane'], range: 'melee', mainAttr: 'str', complexity: 1 },
        { id: 'bane', name: 'Bane', roles: ['support'], range: 'ranged', mainAttr: 'all', complexity: 2 }, // Now universal
        { id: 'batrider', name: 'Batrider', roles: ['offlane', 'mid'], range: 'ranged', mainAttr: 'all', complexity: 2 },
        { id: 'beastmaster', name: 'Beastmaster', roles: ['offlane'], range: 'melee', mainAttr: 'all', complexity: 3 },
        { id: 'bloodseeker', name: 'Bloodseeker', roles: ['carry', 'offlane'], range: 'melee', mainAttr: 'agi', complexity: 1 },
        { id: 'bounty_hunter', name: 'Bounty Hunter', roles: ['support', 'offlane'], range: 'melee', mainAttr: 'agi', complexity: 1 },
        { id: 'brewmaster', name: 'Brewmaster', roles: ['offlane'], range: 'melee', mainAttr: 'all', complexity: 3 },
        { id: 'bristleback', name: 'Bristleback', roles: ['offlane', 'carry'], range: 'melee', mainAttr: 'str', complexity: 1 },
        { id: 'broodmother', name: 'Broodmother', roles: ['offlane', 'mid'], range: 'melee', mainAttr: 'all', complexity: 3 },
        { id: 'centaur', name: 'Centaur Warrunner', roles: ['offlane'], range: 'melee', mainAttr: 'str', complexity: 1 },
        { id: 'chaos_knight', name: 'Chaos Knight', roles: ['carry', 'offlane'], range: 'melee', mainAttr: 'str', complexity: 1 },
        { id: 'chen', name: 'Chen', roles: ['support'], range: 'ranged', mainAttr: 'all', complexity: 3 },
        { id: 'clinkz', name: 'Clinkz', roles: ['carry', 'mid'], range: 'ranged', mainAttr: 'agi', complexity: 2 },
        { id: 'rattletrap', name: 'Clockwerk', roles: ['support', 'offlane'], range: 'melee', mainAttr: 'all', complexity: 2 },
        { id: 'crystal_maiden', name: 'Crystal Maiden', roles: ['support'], range: 'ranged', mainAttr: 'int', complexity: 1 },
        { id: 'dark_seer', name: 'Dark Seer', roles: ['offlane'], range: 'melee', mainAttr: 'all', complexity: 1 },
        { id: 'dark_willow', name: 'Dark Willow', roles: ['support', 'mid'], range: 'ranged', mainAttr: 'all', complexity: 2 },
        { id: 'dawnbreaker', name: 'Dawnbreaker', roles: ['offlane', 'carry'], range: 'melee', mainAttr: 'str', complexity: 1 },
        { id: 'dazzle', name: 'Dazzle', roles: ['support', 'mid'], range: 'ranged', mainAttr: 'all', complexity: 1 },
        { id: 'death_prophet', name: 'Death Prophet', roles: ['mid', 'offlane'], range: 'ranged', mainAttr: 'int', complexity: 1 },
        { id: 'disruptor', name: 'Disruptor', roles: ['support'], range: 'ranged', mainAttr: 'int', complexity: 2 },
        { id: 'doom_bringer', name: 'Doom', roles: ['offlane', 'carry'], range: 'melee', mainAttr: 'str', complexity: 2 },
        { id: 'dragon_knight', name: 'Dragon Knight', roles: ['mid', 'offlane'], range: 'melee', mainAttr: 'str', complexity: 1 },
        { id: 'drow_ranger', name: 'Drow Ranger', roles: ['carry'], range: 'ranged', mainAttr: 'agi', complexity: 1 },
        { id: 'earth_spirit', name: 'Earth Spirit', roles: ['support', 'mid'], range: 'melee', mainAttr: 'str', complexity: 3 },
        { id: 'earthshaker', name: 'Earthshaker', roles: ['support', 'offlane'], range: 'melee', mainAttr: 'str', complexity: 2 },
        { id: 'elder_titan', name: 'Elder Titan', roles: ['offlane', 'support'], range: 'melee', mainAttr: 'str', complexity: 2 },
        { id: 'ember_spirit', name: 'Ember Spirit', roles: ['mid', 'carry'], range: 'melee', mainAttr: 'agi', complexity: 2 },
        { id: 'enchantress', name: 'Enchantress', roles: ['support', 'offlane'], range: 'ranged', mainAttr: 'int', complexity: 2 },
        { id: 'enigma', name: 'Enigma', roles: ['offlane', 'support'], range: 'ranged', mainAttr: 'all', complexity: 2 },
        { id: 'faceless_void', name: 'Faceless Void', roles: ['carry'], range: 'melee', mainAttr: 'agi', complexity: 2 },
        { id: 'grimstroke', name: 'Grimstroke', roles: ['support'], range: 'ranged', mainAttr: 'int', complexity: 2 },
        { id: 'gyrocopter', name: 'Gyrocopter', roles: ['carry', 'support'], range: 'ranged', mainAttr: 'agi', complexity: 1 },
        { id: 'hoodwink', name: 'Hoodwink', roles: ['support', 'mid'], range: 'ranged', mainAttr: 'agi', complexity: 2 },
        { id: 'huskar', name: 'Huskar', roles: ['carry', 'mid'], range: 'ranged', mainAttr: 'str', complexity: 1 },
        { id: 'invoker', name: 'Invoker', roles: ['mid'], range: 'ranged', mainAttr: 'int', complexity: 3 },
        { id: 'wisp', name: 'Io', roles: ['support'], range: 'ranged', mainAttr: 'all', complexity: 3 },
        { id: 'jakiro', name: 'Jakiro', roles: ['support'], range: 'ranged', mainAttr: 'int', complexity: 1 },
        { id: 'juggernaut', name: 'Juggernaut', roles: ['carry'], range: 'melee', mainAttr: 'agi', complexity: 1 },
        { id: 'keeper_of_the_light', name: 'Keeper of the Light', roles: ['support', 'mid'], range: 'ranged', mainAttr: 'int', complexity: 2 },
        { id: 'kez', name: 'Kez', roles: ['carry', 'mid'], range: 'melee', mainAttr: 'agi', complexity: 3 }, // Assuming
        { id: 'kunkka', name: 'Kunkka', roles: ['mid', 'offlane', 'support'], range: 'melee', mainAttr: 'str', complexity: 2 },
        { id: 'legion_commander', name: 'Legion Commander', roles: ['offlane', 'mid'], range: 'melee', mainAttr: 'str', complexity: 1 },
        { id: 'leshrac', name: 'Leshrac', roles: ['mid', 'offlane'], range: 'ranged', mainAttr: 'int', complexity: 1 },
        { id: 'lich', name: 'Lich', roles: ['support'], range: 'ranged', mainAttr: 'int', complexity: 1 },
        { id: 'life_stealer', name: 'Lifestealer', roles: ['carry'], range: 'melee', mainAttr: 'str', complexity: 1 },
        { id: 'lina', name: 'Lina', roles: ['mid', 'carry', 'support'], range: 'ranged', mainAttr: 'int', complexity: 1 },
        { id: 'lion', name: 'Lion', roles: ['support'], range: 'ranged', mainAttr: 'int', complexity: 1 },
        { id: 'lone_druid', name: 'Lone Druid', roles: ['carry', 'mid'], range: 'ranged', mainAttr: 'all', complexity: 3 },
        { id: 'luna', name: 'Luna', roles: ['carry'], range: 'ranged', mainAttr: 'agi', complexity: 1 },
        { id: 'lycan', name: 'Lycan', roles: ['carry', 'offlane'], range: 'melee', mainAttr: 'all', complexity: 2 },
        { id: 'magnataur', name: 'Magnus', roles: ['offlane', 'mid', 'support'], range: 'melee', mainAttr: 'all', complexity: 2 },
        { id: 'marci', name: 'Marci', roles: ['support', 'offlane', 'carry'], range: 'melee', mainAttr: 'all', complexity: 2 },
        { id: 'mars', name: 'Mars', roles: ['offlane'], range: 'melee', mainAttr: 'str', complexity: 1 },
        { id: 'medusa', name: 'Medusa', roles: ['carry'], range: 'ranged', mainAttr: 'agi', complexity: 1 },
        { id: 'meepo', name: 'Meepo', roles: ['mid', 'carry'], range: 'melee', mainAttr: 'agi', complexity: 3 },
        { id: 'mirana', name: 'Mirana', roles: ['support', 'carry'], range: 'ranged', mainAttr: 'all', complexity: 2 },
        { id: 'monkey_king', name: 'Monkey King', roles: ['carry', 'mid'], range: 'melee', mainAttr: 'agi', complexity: 2 },
        { id: 'morphling', name: 'Morphling', roles: ['carry', 'mid'], range: 'ranged', mainAttr: 'agi', complexity: 3 },
        { id: 'muerta', name: 'Muerta', roles: ['carry', 'mid'], range: 'ranged', mainAttr: 'int', complexity: 1 },
        { id: 'naga_siren', name: 'Naga Siren', roles: ['carry', 'support'], range: 'melee', mainAttr: 'agi', complexity: 2 },
        { id: 'furion', name: 'Natures Prophet', roles: ['offlane', 'support'], range: 'ranged', mainAttr: 'int', complexity: 2 },
        { id: 'necrolyte', name: 'Necrophos', roles: ['offlane', 'mid'], range: 'ranged', mainAttr: 'int', complexity: 1 },
        { id: 'night_stalker', name: 'Night Stalker', roles: ['offlane'], range: 'melee', mainAttr: 'str', complexity: 1 },
        { id: 'nyx_assassin', name: 'Nyx Assassin', roles: ['support', 'offlane', 'mid'], range: 'melee', mainAttr: 'all', complexity: 1 },
        { id: 'ogre_magi', name: 'Ogre Magi', roles: ['support', 'offlane'], range: 'melee', mainAttr: 'str', complexity: 1 },
        { id: 'omniknight', name: 'Omniknight', roles: ['support', 'offlane'], range: 'melee', mainAttr: 'str', complexity: 1 },
        { id: 'oracle', name: 'Oracle', roles: ['support'], range: 'ranged', mainAttr: 'int', complexity: 3 },
        { id: 'obsidian_destroyer', name: 'Outworld Destroyer', roles: ['mid'], range: 'ranged', mainAttr: 'int', complexity: 2 },
        { id: 'pangolier', name: 'Pangolier', roles: ['offlane', 'mid'], range: 'melee', mainAttr: 'all', complexity: 2 },
        { id: 'phantom_assassin', name: 'Phantom Assassin', roles: ['carry'], range: 'melee', mainAttr: 'agi', complexity: 1 },
        { id: 'phantom_lancer', name: 'Phantom Lancer', roles: ['carry'], range: 'melee', mainAttr: 'agi', complexity: 2 },
        { id: 'phoenix', name: 'Phoenix', roles: ['support', 'offlane'], range: 'ranged', mainAttr: 'all', complexity: 2 },
        { id: 'primal_beast', name: 'Primal Beast', roles: ['offlane', 'mid'], range: 'melee', mainAttr: 'str', complexity: 1 },
        { id: 'puck', name: 'Puck', roles: ['mid', 'offlane'], range: 'ranged', mainAttr: 'int', complexity: 2 },
        { id: 'pudge', name: 'Pudge', roles: ['support', 'offlane', 'mid'], range: 'melee', mainAttr: 'str', complexity: 2 },
        { id: 'pugna', name: 'Pugna', roles: ['support', 'mid'], range: 'ranged', mainAttr: 'int', complexity: 2 },
        { id: 'queenofpain', name: 'Queen of Pain', roles: ['mid', 'carry'], range: 'ranged', mainAttr: 'int', complexity: 2 },
        { id: 'razor', name: 'Razor', roles: ['offlane', 'carry', 'mid'], range: 'ranged', mainAttr: 'agi', complexity: 1 },
        { id: 'riki', name: 'Riki', roles: ['carry', 'support'], range: 'melee', mainAttr: 'agi', complexity: 1 },
        { id: 'ringmaster', name: 'Ringmaster', roles: ['support', 'mid'], range: 'ranged', mainAttr: 'int', complexity: 2 },
        { id: 'rubick', name: 'Rubick', roles: ['support', 'mid'], range: 'ranged', mainAttr: 'int', complexity: 3 },
        { id: 'sand_king', name: 'Sand King', roles: ['offlane'], range: 'melee', mainAttr: 'all', complexity: 1 },
        { id: 'shadow_demon', name: 'Shadow Demon', roles: ['support'], range: 'ranged', mainAttr: 'int', complexity: 2 },
        { id: 'nevermore', name: 'Shadow Fiend', roles: ['mid', 'carry'], range: 'ranged', mainAttr: 'agi', complexity: 2 },
        { id: 'shadow_shaman', name: 'Shadow Shaman', roles: ['support'], range: 'ranged', mainAttr: 'int', complexity: 1 },
        { id: 'silencer', name: 'Silencer', roles: ['support', 'mid'], range: 'ranged', mainAttr: 'int', complexity: 2 },
        { id: 'skywrath_mage', name: 'Skywrath Mage', roles: ['support', 'mid'], range: 'ranged', mainAttr: 'int', complexity: 1 },
        { id: 'slardar', name: 'Slardar', roles: ['offlane', 'carry'], range: 'melee', mainAttr: 'str', complexity: 1 },
        { id: 'slark', name: 'Slark', roles: ['carry'], range: 'melee', mainAttr: 'agi', complexity: 2 },
        { id: 'snapfire', name: 'Snapfire', roles: ['support', 'mid'], range: 'ranged', mainAttr: 'all', complexity: 1 },
        { id: 'sniper', name: 'Sniper', roles: ['mid', 'carry', 'support'], range: 'ranged', mainAttr: 'agi', complexity: 1 },
        { id: 'spectre', name: 'Spectre', roles: ['carry'], range: 'melee', mainAttr: 'agi', complexity: 2 },
        { id: 'spirit_breaker', name: 'Spirit Breaker', roles: ['offlane', 'support'], range: 'melee', mainAttr: 'str', complexity: 1 },
        { id: 'storm_spirit', name: 'Storm Spirit', roles: ['mid'], range: 'ranged', mainAttr: 'int', complexity: 2 },
        { id: 'sven', name: 'Sven', roles: ['carry', 'support'], range: 'melee', mainAttr: 'str', complexity: 1 },
        { id: 'techies', name: 'Techies', roles: ['support', 'mid'], range: 'ranged', mainAttr: 'all', complexity: 2 },
        { id: 'templar_assassin', name: 'Templar Assassin', roles: ['mid', 'carry'], range: 'ranged', mainAttr: 'agi', complexity: 2 },
        { id: 'terrorblade', name: 'Terrorblade', roles: ['carry'], range: 'melee', mainAttr: 'agi', complexity: 2 },
        { id: 'tidehunter', name: 'Tidehunter', roles: ['offlane'], range: 'melee', mainAttr: 'str', complexity: 1 },
        { id: 'shredder', name: 'Timbersaw', roles: ['offlane', 'mid'], range: 'melee', mainAttr: 'all', complexity: 2 },
        { id: 'tinker', name: 'Tinker', roles: ['mid', 'support'], range: 'ranged', mainAttr: 'int', complexity: 3 },
        { id: 'tiny', name: 'Tiny', roles: ['mid', 'support', 'carry'], range: 'melee', mainAttr: 'str', complexity: 2 },
        { id: 'treant', name: 'Treant Protector', roles: ['support', 'offlane'], range: 'melee', mainAttr: 'str', complexity: 2 },
        { id: 'troll_warlord', name: 'Troll Warlord', roles: ['carry'], range: 'ranged', mainAttr: 'agi', complexity: 2 },
        { id: 'tusk', name: 'Tusk', roles: ['support', 'mid', 'offlane'], range: 'melee', mainAttr: 'str', complexity: 1 },
        { id: 'abyssal_underlord', name: 'Underlord', roles: ['offlane'], range: 'melee', mainAttr: 'str', complexity: 1 },
        { id: 'undying', name: 'Undying', roles: ['support', 'offlane'], range: 'melee', mainAttr: 'str', complexity: 1 },
        { id: 'ursa', name: 'Ursa', roles: ['carry'], range: 'melee', mainAttr: 'agi', complexity: 1 },
        { id: 'vengefulspirit', name: 'Vengeful Spirit', roles: ['support', 'carry', 'offlane'], range: 'ranged', mainAttr: 'all', complexity: 1 },
        { id: 'venomancer', name: 'Venomancer', roles: ['support', 'offlane'], range: 'ranged', mainAttr: 'all', complexity: 1 },
        { id: 'viper', name: 'Viper', roles: ['offlane', 'mid'], range: 'ranged', mainAttr: 'agi', complexity: 1 },
        { id: 'visage', name: 'Visage', roles: ['mid', 'support'], range: 'ranged', mainAttr: 'all', complexity: 3 },
        { id: 'void_spirit', name: 'Void Spirit', roles: ['mid', 'offlane'], range: 'melee', mainAttr: 'all', complexity: 2 },
        { id: 'warlock', name: 'Warlock', roles: ['support'], range: 'ranged', mainAttr: 'int', complexity: 1 },
        { id: 'weaver', name: 'Weaver', roles: ['carry', 'support', 'offlane'], range: 'ranged', mainAttr: 'agi', complexity: 2 },
        { id: 'windrunner', name: 'Windranger', roles: ['mid', 'support', 'offlane'], range: 'ranged', mainAttr: 'all', complexity: 2 },
        { id: 'winter_wyvern', name: 'Winter Wyvern', roles: ['support'], range: 'ranged', mainAttr: 'all', complexity: 2 },
        { id: 'witch_doctor', name: 'Witch Doctor', roles: ['support'], range: 'ranged', mainAttr: 'int', complexity: 1 },
        { id: 'skeleton_king', name: 'Wraith King', roles: ['carry', 'offlane'], range: 'melee', mainAttr: 'str', complexity: 1 },
        { id: 'zuus', name: 'Zeus', roles: ['mid', 'support'], range: 'ranged', mainAttr: 'int', complexity: 1 },
        { id: 'largo', name: 'Largo', roles: ['support'], range: 'ranged', mainAttr: 'int', complexity: 2 }
    ];

    
    // Добавляем состояние "banned"
    heroesData.forEach(h => h.banned = false);

    const challenges = [
        "Пассивная агрессия (Никаких активных предметов)",
        "Азбука (Все предметы должны начинаться на одну букву)",
        "Терпила (Не качать ульту до 12 уровня)",
        "Правая кнопка мыши (Играем без способностей, только удары)",
        "Бомж-стайл (Не грейдить коричневый сапог всю игру)",
        "Керри-Саппорт (Саппорт забирает фарм и собирается в урон)",
        "Золотая лихорадка (Мидас первым слотом до сапога)",
        "Пешеход (Запрещено использовать свитки телепортации)",
        "Снайпер (Только таргетные предметы, никаких по области)",
        "Стеклянная пушка (Максимум урона, 0 предметов на защиту)",
        "Пацифист (Не добивать крипов первые 5 минут, только денаить)",
        "Личный телохранитель (Всю игру ходить парой, не разделяться)",
        "Дагон-Мастер (Дагон 5 уровня — главная цель игры)",
        "Старый дед (Не использовать курьера, ходить в лавку ногами)",
        "Вслепую (Не покупать и не ставить варды)",
        "Метеор гейминг (Оба игрока обязаны собрать Meteor Hammer)",
        "Киберспорт (Общаться только через колесо чата, без голоса)",
        "Жадность (Никаких байбеков, копим на Divine Rapier)",
        "Лесник (Один из игроков не выходит из леса до 10 минуты)",
        "Атрибут-мен (Сначала качаем 'плюсики', потом способности)"
    ];

// --- STATE ---
    // Вставь сюда свои прямые ссылки с postimages (должны заканчиваться на .jpg или .png)
    let players = [
        { 
            id: 1, 
            name: "Влад", 
            avatar: "https://i.postimg.cc/q7jVKN46/Gemini-Generated-Image-w7bgv3w7bgv3w7bg.png", 
            isRolling: false, 
            roles: ['carry','mid','offlane','support'], 
            range: 'all' 
        },
        { 
            id: 2, 
            name: "Богдан", 
            avatar: "https://i.postimg.cc/2Sx8H8Cj/Gemini-Generated-Image-wiztiawiztiawizt.png", 
            isRolling: false, 
            roles: ['carry','mid','offlane','support'], 
            range: 'all' 
        }
    ];
    let audioContext = null;

let activeFilters = {
        attr: null,    // 'str', 'agi', 'int', 'all'
        complex: null  // 1, 2, 3
    };

    document.addEventListener('DOMContentLoaded', () => {
        renderPlayers();
        renderHeroGrid();
    });

    // --- AUDIO ---
    function initAudio() {
        if (!audioContext) {
            audioContext = new (window.AudioContext || window.webkitAudioContext)();
        }
    }

    function playDrumSound() {
        if (!audioContext) return;
        const osc = audioContext.createOscillator();
        const gain = audioContext.createGain();
        osc.frequency.setValueAtTime(150, audioContext.currentTime);
        osc.frequency.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.1);
        gain.gain.setValueAtTime(0.3, audioContext.currentTime);
        gain.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.1);
        osc.connect(gain);
        gain.connect(audioContext.destination);
        osc.start();
        osc.stop(audioContext.currentTime + 0.1);
    }

    // --- IMAGE LOGIC (HYBRID) ---
    // Для рулетки используем вертикальные (старые) и горизонтальные (новые)
    function getHeroImage(heroId) {
        if (heroId === 'largo') return 'https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSj842qMuza342YOEuvN28C5h2DOFsMh4ga0Q&s';
        
        const newHeroes = ['dawnbreaker', 'hoodwink', 'kez', 'marci', 'muerta', 'primal_beast', 'ringmaster', 'snapfire', 'void_spirit'];
        
        if (newHeroes.includes(heroId)) {
            return `https://cdn.cloudflare.steamstatic.com/apps/dota2/images/dota_react/heroes/${heroId}.png`;
        }
        return `https://cdn.cloudflare.steamstatic.com/apps/dota2/images/heroes/${heroId}_vert.jpg`;
    }

    // --- GRID IMAGE LOGIC (FIX) ---
    // Для сетки банов используем ТОЛЬКО ГОРИЗОНТАЛЬНЫЕ БАННЕРЫ (lg.png), чтобы сетка была ровной
    function getGridImage(heroId) {
        if (heroId === 'largo') return 'https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSj842qMuza342YOEuvN28C5h2DOFsMh4ga0Q&s';
        if (heroId === 'kez') return 'https://cdn.cloudflare.steamstatic.com/apps/dota2/images/dota_react/heroes/kez.png';
        // У Valve есть формат _lg.png (Large Banner), который идеален для сетки
        // Но для новых героев его нет, берем dota_react png
        const newHeroes = ['dawnbreaker', 'hoodwink', 'marci', 'muerta', 'primal_beast', 'ringmaster', 'snapfire', 'void_spirit'];
        
        if (newHeroes.includes(heroId)) {
             return `https://cdn.cloudflare.steamstatic.com/apps/dota2/images/dota_react/heroes/${heroId}.png`;
        }
        
        return `https://cdn.cloudflare.steamstatic.com/apps/dota2/images/heroes/${heroId}_lg.png`;
    }

    // --- RENDER PLAYERS ---
    function renderPlayers() {
        const container = document.getElementById('players-container');
        container.innerHTML = '';
        players.forEach((player) => {
            const card = document.createElement('div');
            card.className = 'player-card';
            const checkCarry = player.roles.includes('carry') ? 'checked' : '';
            const checkMid = player.roles.includes('mid') ? 'checked' : '';
            const checkHard = player.roles.includes('offlane') ? 'checked' : '';
            const checkSupp = player.roles.includes('support') ? 'checked' : '';
            const radAll = player.range === 'all' ? 'checked' : '';
            const radMelee = player.range === 'melee' ? 'checked' : '';
            const radRanged = player.range === 'ranged' ? 'checked' : '';

            card.innerHTML = `
                <button class="btn-remove" onclick="removePlayer(${player.id})" title="Удалить слот">×</button>
                <input type="text" class="player-name-input" value="${player.name}" onchange="updateName(${player.id}, this.value)">
                
                <div class="filters-container">
                    <div class="filter-group">
                        <span class="filter-title">Роль</span>
                        <div class="filter-row">
                            <label class="filter-label"><input type="checkbox" onchange="updateRole(${player.id}, 'carry', this.checked)" ${checkCarry}> Керри</label>
                            <label class="filter-label"><input type="checkbox" onchange="updateRole(${player.id}, 'mid', this.checked)" ${checkMid}> Мид</label>
                            <label class="filter-label"><input type="checkbox" onchange="updateRole(${player.id}, 'offlane', this.checked)" ${checkHard}> Хард</label>
                            <label class="filter-label"><input type="checkbox" onchange="updateRole(${player.id}, 'support', this.checked)" ${checkSupp}> Сапп</label>
                        </div>
                    </div>
                    <div class="filter-group" style="border:none;">
                        <span class="filter-title">Тип атаки</span>
                        <div class="filter-row">
                            <label class="filter-label"><input type="radio" name="range_${player.id}" onchange="updateRange(${player.id}, 'all')" ${radAll}> Любой</label>
                            <label class="filter-label"><input type="radio" name="range_${player.id}" onchange="updateRange(${player.id}, 'melee')" ${radMelee}> Ближ.</label>
                            <label class="filter-label"><input type="radio" name="range_${player.id}" onchange="updateRange(${player.id}, 'ranged')" ${radRanged}> Дальн.</label>
                        </div>
                    </div>
                </div>

                <div class="slot-window" id="window-${player.id}">
                    <div class="reel" id="reel-${player.id}">
                        <img src="${player.avatar}" class="hero-img" style="opacity:1;">
                    </div>
                    <div class="hero-name-overlay" id="name-${player.id}">Ready</div>
                </div>

                <button class="btn-reroll" onclick="rollSingle(${player.id})">REROLL</button>
            `;
            container.appendChild(card);
        });
    }

    function addPlayer(position) {
        const newId = Date.now();
        const defaultAvatar = "https://cdn.cloudflare.steamstatic.com/apps/dota2/images/dota_react/global/dota2_logo_symbol.png";
        const newPlayer = { id: newId, name: "Игрок", avatar: defaultAvatar, isRolling: false, roles: ['carry','mid','offlane','support'], range: 'all' };
        if(position === 'start') players.unshift(newPlayer);
        else players.push(newPlayer);
        renderPlayers();
    }
    
    function removePlayer(id) {
        if(players.length <= 1) return;
        players = players.filter(p => p.id !== id);
        renderPlayers();
    }
    function updateName(id, val) { const p = players.find(p => p.id === id); if(p) p.name = val; }
    function updateRole(id, role, checked) {
        const p = players.find(p => p.id === id);
        if(p) { if(checked && !p.roles.includes(role)) p.roles.push(role); if(!checked) p.roles = p.roles.filter(r => r !== role); }
    }
    function updateRange(id, val) { const p = players.find(p => p.id === id); if(p) p.range = val; }

    // --- GRID & FILTER LOGIC ---
    function renderHeroGrid() {
        const grid = document.getElementById('hero-grid');
        grid.innerHTML = '';
        
        // Filter logic
        const searchTerm = document.getElementById('hero-search-input')?.value.toLowerCase() || "";
        
        heroesData.forEach(hero => {
            // Check filters
            if (activeFilters.attr && hero.mainAttr !== activeFilters.attr) return;
            if (activeFilters.complex && hero.complexity !== activeFilters.complex) return;
            if (searchTerm && !hero.name.toLowerCase().includes(searchTerm)) return;

            const div = document.createElement('div');
            div.className = `hero-grid-item ${hero.banned ? 'banned' : ''}`;
            div.onclick = () => toggleHeroBan(hero.id);
            
            const img = document.createElement('img');
            // Используем новую функцию для сетки!
            img.src = getGridImage(hero.id);
            img.title = hero.name;
            img.onerror = function() { this.src = 'https://cdn.cloudflare.steamstatic.com/apps/dota2/images/dota_react/icons/hero_universal.png'; };
            
            div.appendChild(img);
            grid.appendChild(div);
        });
    }

    function toggleFilter(type, value, btn) {
        if (activeFilters[type] === value) {
            // Toggle off
            activeFilters[type] = null;
            btn.classList.remove('active');
        } else {
            // Switch on
            activeFilters[type] = value;
            // Remove active from siblings
            const parent = btn.parentElement;
            const siblings = parent.children;
            for (let i = 0; i < siblings.length; i++) {
                siblings[i].classList.remove('active');
            }
            btn.classList.add('active');
        }
        applyGridFilters();
    }

    function applyGridFilters() {
        renderHeroGrid();
    }

    function toggleBanList() {
        const modal = document.getElementById('ban-modal');
        modal.style.display = (modal.style.display === 'flex') ? 'none' : 'flex';
    }

    function toggleHeroBan(heroId) {
        const hero = heroesData.find(h => h.id === heroId);
        if(hero) {
            hero.banned = !hero.banned;
            renderHeroGrid(); // Re-render to show X
        }
    }

    // --- ROLL LOGIC ---
    function getPoolForPlayer(player) {
        return heroesData.filter(hero => {
            if (hero.banned) return false;
            if (player.range !== 'all' && hero.range !== player.range) return false;
            return hero.roles.some(r => player.roles.includes(r));
        });
    }

    function rollAll() {
        initAudio();
        players.forEach((p, index) => { setTimeout(() => { rollSingle(p.id); }, index * 200); });
    }

    function rollSingle(playerId) {
        const player = players.find(p => p.id === playerId);
        if(!player || player.isRolling) return;
        initAudio();
        const reel = document.getElementById(`reel-${playerId}`);
        const windowEl = document.getElementById(`window-${playerId}`);
        const nameOverlay = document.getElementById(`name-${playerId}`);
        
        windowEl.classList.remove('finished');
        nameOverlay.style.opacity = '0';
        player.isRolling = true;

        const pool = getPoolForPlayer(player);
        if(pool.length === 0) {
            alert(`${player.name}: Нет героев!`);
            player.isRolling = false;
            return;
        }

        const winner = pool[Math.floor(Math.random() * pool.length)];
        const reelLength = 20;
        reel.innerHTML = '';
        
        for(let i=0; i<reelLength; i++) {
            const randomH = heroesData[Math.floor(Math.random() * heroesData.length)];
            const img = document.createElement('img');
            img.src = getHeroImage(randomH.id);
            img.className = 'hero-img';
            img.onerror = function() { this.src = 'https://cdn.cloudflare.steamstatic.com/apps/dota2/images/dota_react/icons/hero_universal.png'; };
            reel.appendChild(img);
        }
        
        const winnerImg = document.createElement('img');
        winnerImg.src = getHeroImage(winner.id);
        winnerImg.className = 'hero-img';
        reel.appendChild(winnerImg);

        reel.style.transition = 'none';
        reel.style.top = '0px';
        void reel.offsetWidth;

        const totalHeight = reelLength * 272; // height from CSS
        reel.style.transition = 'top 2.5s cubic-bezier(0.15, 0.9, 0.3, 1)';
        reel.style.top = `-${totalHeight}px`;

        let drumInterval = setInterval(playDrumSound, 150);

        setTimeout(() => {
            clearInterval(drumInterval);
            playDrumSound();
            reel.style.transition = 'none';
            reel.innerHTML = '';
            reel.appendChild(winnerImg);
            reel.style.top = '0px';
            nameOverlay.textContent = winner.name;
            windowEl.classList.add('finished');
            player.isRolling = false;
        }, 2500);
    }

    function generateChallenge() {
        initAudio();
        const output = document.getElementById('challenge-output');
        const text = challenges[Math.floor(Math.random() * challenges.length)];
        output.textContent = "Габен печатает...";
        setTimeout(() => { output.textContent = text; playDrumSound(); }, 500);
    }
</script>
</body>
</html>
